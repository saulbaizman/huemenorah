<!--

This will likely have to be run through an HTTP server.

The RP unit will need to have Python installed and the simpleHTTPServer module.

When the RP boots, it will need to run the web server and launch the web browser, pointed at a specific URL like this:

  http://127.0.0.1:8000/client.html

-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HueMenorah client</title>

    <style type="text/css">
        body {
            margin: 0 ;
        }
        img {
            position: absolute;
            top: 0 ;
            left: 0 ;
        }
        p {
            margin-top: 500px ;
        }
        #img_bg {
            z-index: -1;
        }
    </style>

    <!-- load Firebase library -->
    
    <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>

    <!-- load jQuery library -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>-->

    <!-- Commands go here. -->

    <script type="text/javascript">

        // CHANGE THE CLIENT ID BELOW
        var client_id = '0' ; // customize this per client. No duplicates expected!

        var fb_url = 'https://huemenorah.firebaseio.com/' ;
        var image_folder = 'imagery/' ;

        var myFirebase = new Firebase(fb_url) ;

        var client_details ;

        update_browser_image ( ) ;

        function update_browser_image ( ) {

            jQuery.getJSON( 'test.json', '', function ( response ) {
                console.log ( 'loading JSON...' ) ;
//                console.log ( response ) ;

                console.log ( 'getting JSON config for ***CLIENT ' + client_id + '***...' ) ;
                client_details = response[client_id] ;

                console.log ( 'CLIENT ' + client_id + ' details:' ) ;
                console.log ( client_details ) ;

                var image_url = client_details.path ;
                console.log ( 'image_url: ' + image_url ) ;

                // Load new image "under" the current image.
                // Fade out the foreground image.
                // Move the new image into the foreground image "spot."

                // http://stackoverflow.com/questions/4285042/asychronously-load-images-with-jquery
                if ( jQuery('#img_fg').length ) {
                    // Load new image, fade the old one, and swap IDs
                    var img = jQuery("<img id='img_bg' />").attr('src', image_folder + image_url )
                            .on('load', function() {
                                if (!this.complete || typeof this.naturalWidth == "undefined" || this.naturalWidth == 0) {
                                    console.error('broken image!'); // image did not load correctly!
                                } else {
                                    // Image loaded successfully.
                                    jQuery('body').append( img ) ;                  // add new image to the DOM
                                    jQuery('#img_fg').fadeOut(1000, function () {   // fade out the foreground image
                                        jQuery('#img_fg').remove();                 // remove the foreground image from the DOM
                                        jQuery('#img_bg').attr('id','img_fg') ;     // make the bg image the new fg image
                                    });
                                }
                            });
                }
                else {
                    // Just load an image.
                    var img = jQuery("<img id='img_fg' />").attr('src', image_folder + image_url )
                            .on('load', function() {
                                if (!this.complete || typeof this.naturalWidth == "undefined" || this.naturalWidth == 0) {
                                    console.error('broken image!'); // image did not load correctly!
                                } else {
                                    // Image loaded successfully.
                                    jQuery('body').append( img );                   // add new image to the DOM
                                }
                            });

                }

            } ) ;
        }

    </script>

</head>
<body>

<p><a href="#" id="refresh">update browser image</a></p>

<script type="text/javascript">

    jQuery("#refresh").on( 'click', function ( event ) {
                event.preventDefault ( ) ;
                console.log ( 'updating browser image' ) ;
                update_browser_image ( ) ;
            }
    ) ;

</script>
</body>
</html>